Бонусы юзеров:

политика конфиденциальности
бонусная система (ссылка + чекбокс)
получение рекламных материалов (чек бокс без ссылки)

чекбокс рекламы в лк


-------------------------------------------------------------------
Геттер 1с:

история изменений ?

-------------------------------------------------------------------
бонусы:

- добавить фильтр бонусов в админку
- добавить чек бок при редактировании юзера в админке

- ссылка для qr на участие в бонусной системе 
- передавать новых юзеров в 1с?
задача геттера шинсервис

*****

- подготовить csv файл с юзерами для бонус программы
- вывод кол-ва бонусов в админке
- всплывающий блок скрыть
- ссылка на статичную страницу в всплывающем блоке
- кнопка в футер
- регистрация скрыть чек бокс
- передавать по дефолту true
- стартовый текст статичной страницы -
- передавать новых юзеров в 1с?
- доделать попап регистрации нового юзера
- ссылка на регистрацию + qr сгенерированный на основе ссылки
- скрывать чек бокс в лк если бонус система + true
- добавить чек бокс в админку -
- фильтр бонусов в админке -
- прокинуть новый параметр бонусов в юзеров +
- добавить галку бонусов в регистрации +

-------------------------------------------------------------------

рэббит на тайресе для бонусов

- лч - адаптив
- история лч
- расчет бонусов для клиента
- вывод истории


- бонусы корзина
- прокинуть новый параметр в апи заказа
- документация для 1с апи бонусов

*****

- бонусы карточка товара +
- бонусы каталог +

-------------------------------------------------------------------
https://help.tyres.spb.ru/issues/80063

- история по бонусам
- очередь на актуальное кол-во бонусов
- бонусы в базе обмена
- запрос как промокод
- условия для брендов

ознакомиться с инфо к задаче
прикинуть структуру сообщений

оценить насколько сложно поднять рэббит со стороны тайрес

-------------------------------------------------------------------
вопрос - в какой момент будет происходить начисление бонусов - когда заказ оплачен

когда заказ оформлен? 
или когда заказ получен?

Необходимо будет набросать документацию по событиям.

1 очередь - начисление бонусов при событии (покупка, услуги и т.д.):

Предполагается 3 пути взаимодействия.
1 - пуш сообщений о событиях в рэббит.
2 - апи для получения полной истории бонусов по клиенту
3 - пуш кол-ва бонусов в exchange новым свойствам к гудам

1:

idUser - идентификатор юзера
idOperationType - тип операции (списание, начисление)
bonusCount - количество бонусов
idEventType - тип события (заказ, услуга)
idEvent - идентификатор события (заказа, услуги)
date - дата сделки

bonus_operation_type
id name

bonus_event_type
id name

bonus_event
id idUser idOperationType idEventType idEvent createdAt bonusCount

[{
  "body": {
    "id_user": b89ef299-041f-11ec-b3c0-ac1f6b4daebb,
    "id_operation_type": 2,
    "bonus_count": 300,
    "id_event_type": 3,
    "id_event", 47,
    "date": 456456234
  }
}]

набросок структуры сообщения в рэббит:

type - тип (заказ или услуга order, service)
idOperation - начисление или списывание
idEvent - id события (заказ, запись на мойку, запись на шиномонтаж)
bonusCount - кол-во бонусов начислено
idOrder - id заказа
idService - id услуги
date - дата события (timestamp или обычная дата)

[{
  "type": "order",
  "body": {
    "idUser": b89ef299-041f-11ec-b3c0-ac1f6b4daebb,
    "idEvent": 3,
    "bonusCount": 300,
    "idOperation": 1,
    "idOrder": 4,
    "idService", Null
    "date": 456456234
  }
}]

2:
Api запрос истории 

запрос:

{
  "phone": "9319232222"
}

ответ:

[
  {
    "body": [
      {
        "idEvent": 3,
        "bonusCount": 300,
        "idOperation": 1,
        "idOrder": 4,
        "idService": null,
        "date": 456456234
      },
      {
        "idEvent": 2,
        "bonusCount": 300,
        "idOperation": 1,
        "idOrder": 6,
        "idService": null,
        "date": 456456245
      },
      {
        "idEvent": 3,
        "bonusCount": 300,
        "idOperation": 2,
        "idOrder": 7,
        "idService": null,
        "date": 456456278
      }
    ]
  }
]

3:
бонусы привязываем в exchange в каждогу гуду новым полем.
Мы забираем эти данные и отображаем на сайте.
